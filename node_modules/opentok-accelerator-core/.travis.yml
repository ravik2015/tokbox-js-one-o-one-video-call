language: node_js
node_js:
- '4.4'
before_install:
- export CHROME_BIN=chromium-browser
- export DISPLAY=:99.0
- sh -e /etc/init.d/xvfb start
script:
- npm run build
- npm test
- if [[ "$TRAVIS_PULL_REQUEST" == "false" ]]; then
    VERSION=$(jq '.version' package.json | sed -e 's/^"//' -e 's/"$//');
    git commit -m "New build. Bump npm version." --allow-empty;
    git tag v$VERSION;
    git push --quiet https://$GITHUBKEY@github.com/opentok/accelerator-core-js v$VERSION;
  fi
deploy:
  provider: npm
  email: vsolutions@tokbox.com
  api_key:
    secure: p9jyhkhbjaKnr/9iJj1xDSDBem7dIUIOvh/LnGrO1WE0iDd6wLQ9R0XVfW6DpwKws8q/B2Aw16WS4/Brp65KqFjmAXhws/tJPLcuBLzW2J34qICEOxotNuGvchv+5uoNJpOM06ntyq6WU//lxle0FdretkKOQOAyX+CvIAlWO8QIQaRgu7HcsKr5qnZQfOJV3P7JO0Fu8sWQR8oWvaR+qJp1Aps6kg5EZ60KyorH1+2WmLXfYIiI6vT32plQqeXP91nNN/WnEBy2k5URapGWdngr8/7Dc3YQ4/QAfDCCeSkyGv9X5W46uTfmwCE8MMAsyaI93mpphY1pL6rz+hZqm0yiKTLrMXzMSNuTMWdBKgNQnEe3a2G0HfPLxR5P2KLY1CCsopimy6Xr0nVgEpmSD1LbhzjcRk21ZNJhGw2PmNPK9DPJzF4+eywj1dk9l9i92QTpESxviTWd0S8XLxLIq6SYW+RyW4M913jOH2jbXqJMT8WCjSM86V1u27DeBLPwpNsCfuHCnNlF0/vZDtnpkfexfhvULut7ZnCpZh4TxWyfaInZzI+2eSmbwuU28BeyRuDf3uA24xKHjLl3YAKj9cEQTi7BhPsPV2I90Gbrfasf1snAe8argwdzGct6l/8C8aL+qkHggvENgTf+R1UGw841hfIYLtCjupL/G2kLRDg=
  on:
    branch: master
  skip_cleanup: true
notifications:
  slack:
    secure: csFMBAr1OOgB41jMXzwVzrO58PsOdFSRnyN+h0nXfEd0aL1UbrOxbgqqMwpWJwkZnJENnVuW1tkxFXoGnq6sJjOywLPkPqCf0dPGEWTUvbsdsFrNivtNbjT/kY3BI5sz13ENGyZuzD68bQ/Za7JQUgAlkOX0jlml8ZtBABkvPQaFAcqDHoiZrTgSjv5rvwHC6Wo8Fi50PsE662X7HtIrLCk+Xaoi5rzTf/5vB3gGJysCV3qmB6t+9QOBElmjPERHOfVLkKiexjDJQ3jSBmR164vUZL0207+Y9GuyDq0iTHumEu5LK+xoAikOFRoGVH0iWUCtrJPg/SeWCJ1KxKI1Fymc2atQ7zTXyZxj18GrB3xxkW3qH/1rNH8OJoV6bHTr8tNaoRHGbwawo0hioEQ7h5X4b0xHAqpyJq1QcbZ7rBJu7sKIxP58qBztzL+Bzue35BNE1N1AVcN3YPU0jxDFSHKAG0ZVgI9hjU0IvLg5YoIaNZCN4MC6C1LVDknxGfjjC6oNE1oOz9xtIw1FNf5SbvoKrmCuqG2qDEQ87QwWTpzXaZajExF6C4p+gMtK3MJjWuCV5AILjc+XLJ7y9AVr5i9ErwTdyXAV5ACUw3riDUklKHGetGA3SPeSO9Lg35yb4OgPoNcZSSZ7y4WZg6iVPaI/gZbLk6PqKFlQZO5jCHg=
